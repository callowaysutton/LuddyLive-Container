(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,a){e.exports=a(16)},16:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(8),o=a.n(l);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=a(2),c=a(3),i=a(5),m=a(4),u=a(6),d=a(1),v=a.n(d),h=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];var o=(a=Object(i.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).props.env,c=void 0===o?"":o;return a.state={envList:[],current:c},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"reload",value:function(){var e=this;return v.a.ajax({url:"/env/"}).then(function(t){console.debug("c=EnvPicker, m=getData, data=%o",t),e.setState({envList:t})},function(e){console.error("c=EnvPicker, m=getData, status=error",e)})}},{key:"deleteCurrent",value:function(){var e=this.state.current;console.log("c=EnvPicker, m=deleteCurrent, env=%s",e);var t=v.a.Deferred();if(""===e){var a="Deleting default environment is not allowed";return window.$.notify({title:"Ops!",message:a},{type:"danger"}),t.rejectWith(new Error(a)),t.promise()}return v.a.ajax("/env/",{type:"DELETE",contentType:"application/json",error:function(e){var a=e.status;200!==a?t.rejectWith(new Error("HTTP ".concat(a))):t.resolve()},success:function(){return t.resolve()},data:JSON.stringify({name:e})}),t.promise()}},{key:"componentDidMount",value:function(){this.reload()}},{key:"handleChanges",value:function(e){var t=this,a=e.target,n=a.options[a.selectedIndex].value;this.setState({current:n},function(){return t.props.onChange(n)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.envList,n=t.current;return console.debug("c=EnvPicker, m=render, env=%s",n),r.a.createElement("div",{className:"input-group"},r.a.createElement("select",{className:"form-control",onChange:function(t){return e.handleChanges(t)},value:n,name:"env"},a.map(function(e,t){var a=e.name;return r.a.createElement("option",{key:a,value:a},a.length?a:"Default")})),r.a.createElement("div",{className:"input-group-append"},r.a.createElement("button",{title:"Create new env",onClick:function(){return e.props.onToggle()},className:"btn btn-info",type:"button"},r.a.createElement("span",{className:"fa fa-plus-circle"})),r.a.createElement("button",{title:"Delete selected env",onClick:function(){e.deleteCurrent().then(function(){return e.props.onDelete()}).fail(function(e){return console.error("m=render, err=%o",e)})},className:"btn btn-danger",type:"button"},r.a.createElement("span",{className:"fa fa-trash-alt"}))))}}]),t}(r.a.PureComponent),p=function(e){var t=e.onCreate,a=e.onCancel,n=r.a.createRef();return r.a.createElement("div",{className:"input-group"},r.a.createElement("input",{placeholder:"my new env...",type:"text",className:"form-control",ref:n}),r.a.createElement("div",{className:"input-group-append"},r.a.createElement("button",{title:"Save",className:"btn btn-info fa fa-save",type:"button",onClick:function(e){return function(e,t){var a=e.replace(/[^a-z0-9\s_-]+/gi,"").trim();a.length?new Promise(function(e,t){v.a.ajax("/env/",{type:"POST",contentType:"application/json",error:function(a){200!==a.status?t(new Error("HTTP ".concat(a.status))):e()},success:function(){return e()},data:JSON.stringify({name:a})})}).then(function(){window.$.notify({message:"Environment '".concat(a,"' created successfully")},{type:"success"}),t(a)},function(e){window.$.notify({title:"Ops!",message:"An error ocurred"},{type:"danger"}),console.error("Could not create environment: %o",e)}):window.$.notify({title:"Ops",message:"Only letters, numbers, _ and - are allowed in environment name"},{type:"warning"})}(n.current.value,t)}}),r.a.createElement("button",{title:"Cancel",className:"btn btn-dark fa fa-times",onClick:function(){return a()},type:"button"})))},f=function(){return r.a.createElement("nav",{className:"navbar navbar-inverse navbar-fixed-top"},r.a.createElement("a",{className:"navbar-brand",href:"#"},"DNS Proxy Server"),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},r.a.createElement("ul",{className:"navbar-nav pull-right"},r.a.createElement("li",{className:"nav-item active"},r.a.createElement("a",{className:"nav-link",href:"#"},"Home ",r.a.createElement("span",{className:"sr-only"},"(current)"))),r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{className:"nav-link",href:"#"},"Features")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{className:"nav-link",href:"#"},"Pricing")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{className:"nav-link disabled",href:"#"},"Disabled")))))},g=a(9),E=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(m.a)(t).call(this))).props=e,a.state={form:{hostname:"mywebsite.acme.com",ip:"192.168.0.1",target:"acme.com",type:"A",ttl:60},showIp:!0,showTarget:!1,valueField:{}},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.env!==t.form.env}},{key:"componentDidMount",value:function(){console.warn("RecordForm did mount, state=%o",this.state),this.processValueLabel(this.state.form.type)}},{key:"handleIp",value:function(e){var t=this.state.form;t[e.target.name]=e.target.value.split(".").map(function(e){return parseInt(e)}),this.setState({form:t})}},{key:"handleChange",value:function(e){var t=this.state.form;t[e.target.name]=e.target.value,this.setState({form:t}),console.debug("m=handleChange, %s=%s",e.target.name,e.target.value)}},{key:"handleNumberChange",value:function(e){var t=this.state.form;t[e.target.name]=parseInt(e.target.value),this.setState({form:t}),console.debug("m=handleChange, %s=%s",e.target.name,e.target.value)}},{key:"handleType",value:function(e){var t=this.state.form,a=e.target,n=a.name,r=a.value;t[n]=r;var l=!1,o=!0;"A"===r&&(l=!0,o=!1),this.setState({form:t,showIp:l,showTarget:o})}},{key:"processValueLabel",value:function(e){var t={A:{label:"IP *",field:"ip"},CNAME:{label:"CNAME *",field:"target"}}[e];return this.setState({valueField:t}),t}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),e.target.checkValidity(),v.a.ajax({method:"POST",url:"/hostname/",contentType:"application/json",data:JSON.stringify(Object(g.a)({},this.state.form,{env:this.props.env}))}).done(function(){window.$.notify({message:"Saved"}),t.props.onUpdate()}).fail(function(e){console.error("m=saveNewLine, status=error",e),e.status<500?window.$.notify({message:JSON.parse(e.responseText).message},{type:"danger"}):window.$.notify({message:e.responseText},{type:"danger"})})}},{key:"render",value:function(){var e=this;return r.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},r.a.createElement("table",{className:"table table-bordered table-hover table-condensed "},r.a.createElement("colgroup",null,r.a.createElement("col",{width:"50%"}),r.a.createElement("col",{width:"14.5%"}),r.a.createElement("col",{width:"14.5%"}),r.a.createElement("col",{width:"9%",style:{textAlign:"right"}}),r.a.createElement("col",{width:"7.5%"})),r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",null,r.a.createElement("label",{className:"control-label ",htmlFor:"hostname"},"Hostname",r.a.createElement("span",{className:"asteriskField"},"*"))),r.a.createElement("th",null,this.state.showIp&&r.a.createElement("label",{className:"control-label requiredField",htmlFor:"ip"},"IP",r.a.createElement("span",{className:"asteriskField"},"*")),this.state.showTarget&&r.a.createElement("label",{className:"control-label requiredField",htmlFor:"target",required:!0},"Target",r.a.createElement("span",{className:"asteriskField"},"*"))),r.a.createElement("th",null,r.a.createElement("label",{className:"control-label"},"Type",r.a.createElement("span",{className:"asteriskField"},"*"))),r.a.createElement("th",null,r.a.createElement("label",{className:"control-label requiredField",htmlFor:"ttl"},"TTL",r.a.createElement("span",{className:"asteriskField"},"*"))),r.a.createElement("th",null,"Actions"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",id:"hostname",name:"hostname",onChange:function(t){return e.handleChange(t)},value:this.state.form.hostname,type:"text",required:!0})),r.a.createElement("td",null,this.state.showIp&&r.a.createElement("input",{className:"form-control",pattern:"[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+",title:"Please provide a valid IP",name:"ip",id:"ip",onChange:function(t){return e.handleIp(t)},required:!0}),this.state.showTarget&&r.a.createElement("input",{className:"form-control",name:"target",id:"target",onChange:function(t){return e.handleChange(t)}})),r.a.createElement("td",null,r.a.createElement("select",{name:"type",onChange:function(t){return e.handleType(t)},className:"form-control",type:"text"},r.a.createElement("option",{value:"A"},"A"),r.a.createElement("option",{value:"CNAME"},"CNAME"))),r.a.createElement("td",null,r.a.createElement("input",{onChange:function(t){return e.handleNumberChange(t)},className:"form-control",value:this.state.form.ttl,id:"ttl",name:"ttl",type:"number",size:"3",min:"1",required:!0})),r.a.createElement("td",{className:"text-center"},r.a.createElement("button",{type:"submit",className:"btn btn-info"},r.a.createElement("span",{className:"fa fa-save"})))))))}}]),t}(r.a.Component),b=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(i.a)(this,Object(m.a)(t).call(this))).state={table:[]},a.props=e,a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.reloadTable()}},{key:"reloadTable",value:function(){var e=this;return v.a.ajax({url:"/hostname/find/?env="+this.props.env+"&hostname="}).then(function(t){e.setState({table:t}),console.debug("c=RecordTable, m=reloadTable, env=%s, data=%o",e.props.env,t)},function(e){console.error("c=RecordTable, m=reloadTable, status=error",e)})}},{key:"swapEditionMode",value:function(e){e.editing=!e.editing,this.setState({someText:"hi"})}},{key:"updateRecord",value:function(e){this.swapEditionMode(e),console.info("updating row "+e.id),v.a.ajax({url:"/hostname",method:"PUT",contentType:"application/json",data:JSON.stringify({env:this.props.env,id:e.id,type:e.type,hostname:e.hostname,ip:e.ip,target:e.target,ttl:e.ttl})}).then(function(e){console.debug("m=save, status=success"),window.$.notify({message:"Saved"})},function(e){console.error("m=save, status=error",e),window.$.notify({message:e.responseText},{type:"danger"})})}},{key:"deleteRecord",value:function(e){var t=this;console.info("deleting "+e.hostname),v.a.ajax({url:"/hostname",method:"DELETE",data:JSON.stringify({env:this.props.env,hostname:e.hostname}),contentType:"application/json"}).then(function(a){console.debug("m=del, status=scucess"),window.$.notify({message:"Removed: "+e.hostname}),t.reloadTable()},function(e){console.error("m=save, status=error",e),window.$.notify({message:e.responseText},{type:"danger"})})}},{key:"formatIp",value:function(e){return e.join(".")}},{key:"handleChange",value:function(e,t){t[e.target.name]=e.target.value,console.info("m=handleChange, %s=%s, row=%o",e.target.name,e.target.value,t),this.forceUpdate()}},{key:"handleNumberChange",value:function(e,t){t[e.target.name]=parseInt(e.target.value),console.info("m=handleChange, %s=%s, row=%o",e.target.name,e.target.value,t),this.forceUpdate()}},{key:"handleIpChange",value:function(e,t){t[e.target.name]=e.target.value.split(".").map(function(e){return e?parseInt(e):""}),this.forceUpdate()}},{key:"handleTargetChange",value:function(e,t){t[e.target.name]=e.target.value,this.forceUpdate(),console.debug("m=handleChange, %s=%s",e.target.name,e.target.value)}},{key:"renderLineView",value:function(e,t){var a=this;return r.a.createElement("tr",{key:t},r.a.createElement("td",null,e.hostname),r.a.createElement("td",{className:"text-center"},e.type),(!e.type||"A"===e.type)&&r.a.createElement("td",null,this.formatIp(e.ip)),"CNAME"===e.type&&r.a.createElement("td",null,e.target),r.a.createElement("td",{className:"text-right"},e.ttl),r.a.createElement("td",{className:"text-center records-actions"},r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-info fa fa-pencil-alt",onClick:function(t){return a.swapEditionMode(e)}}),r.a.createElement("button",{className:"btn btn-danger fa fa-trash-alt",onClick:function(t){return a.deleteRecord(e)}}))))}},{key:"renderLineEditing",value:function(e,t){var a=this;return r.a.createElement("tr",{key:t},r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",name:"hostname",onChange:function(t){return a.handleChange(t,e)},value:e.hostname})),r.a.createElement("td",{className:"text-center"},r.a.createElement("select",{name:"type",onChange:function(t){return a.handleChange(t,e)},value:e.type,className:"form-control"},r.a.createElement("option",{value:"A"},"A"),r.a.createElement("option",{value:"CNAME"},"CNAME"))),("A"===e.type||!e.type)&&r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",name:"ip",type:"text",onChange:function(t){return a.handleIpChange(t,e)},value:this.formatIp(e.ip)})),"CNAME"===e.type&&r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",name:"target",type:"text",onChange:function(t){return a.handleTargetChange(t,e)},value:e.target})),r.a.createElement("td",{className:"text-right"},r.a.createElement("input",{className:"form-control",name:"ttl",type:"number",onChange:function(t){return a.handleNumberChange(t,e)},value:e.ttl})),r.a.createElement("td",{className:"text-center records-actions"},r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{className:"btn btn-primary fa fa-save",onClick:function(t){return a.updateRecord(e)}}),r.a.createElement("button",{className:"btn btn-danger fa fa-times",onClick:function(t){return a.swapEditionMode(e)}}))))}},{key:"render",value:function(){var e=this;return this.state.table.length?r.a.createElement("div",null,r.a.createElement("h3",null,"Records"),r.a.createElement("table",{className:"table table-bordered table-hover table-condensed editable-table demoTable table-hostnames"},r.a.createElement("colgroup",null,r.a.createElement("col",{width:"45%"}),r.a.createElement("col",{width:"15%"}),r.a.createElement("col",{width:"15%"}),r.a.createElement("col",{width:"10%"}),r.a.createElement("col",{width:"10%"})),r.a.createElement("thead",{className:"thead-dark"},r.a.createElement("tr",null,r.a.createElement("th",null,"Hostname"),r.a.createElement("th",{className:"text-center"},"Type"),r.a.createElement("th",null,"Value"),r.a.createElement("th",null,"TTL"),r.a.createElement("th",{className:"text-center"},"Actions"))),r.a.createElement("tbody",null,this.state.table.map(function(t,a){return t.editing?e.renderLineEditing(t,a):e.renderLineView(t,a)})))):r.a.createElement(r.a.Fragment,null)}}]),t}(r.a.Component),y=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(i.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={forceUpdate:null,createEnv:!1,isLoading:!0,env:""},a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.getActiveEnvironment().then(function(t){e.setState({isLoading:!1,env:t.name})},function(e){window.$.notify({message:"Failed to fetch current environment"},{type:"danger"}),console.error("m=componentDidMount, err=%o",e)})}},{key:"activate",value:function(e){console.log("c=Home, m=activate, env=%s",e);var t=v.a.Deferred();return v.a.ajax("/env/active",{type:"PUT",contentType:"application/json",error:function(e){200!==e.status?t.reject():t.resolve()},success:function(){return t.resolve()},data:JSON.stringify({name:e})}),t.promise()}},{key:"toggleEnvForm",value:function(){var e=this.state.createEnv;console.debug("m=Home, m=toggleEnvForm, createEnv=%s",e),this.setState({createEnv:!e})}},{key:"onUpdate",value:function(){var e=this.state.env;this.table.reloadTable(e),this.envPicker.reload(e)}},{key:"onChangeEnv",value:function(e){var t=this;console.debug("c=Home, m=onChangeEnv, env=%s",e),this.activate(e).then(function(){return t.setState({env:e,createEnv:!1},function(){return t.table.reloadTable(t.state.env)})},function(e){window.$.notify({message:"Could not activate environment"},{type:"danger"}),console.error("c=Home, m=onChangeEnv, err=%o",e)})}},{key:"onCreate",value:function(e){this.onChangeEnv(e)}},{key:"onDelete",value:function(){this.onChangeEnv("")}},{key:"getActiveEnvironment",value:function(){return v.a.get("/env/active")}},{key:"renderTable",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row mb-2"},r.a.createElement("div",{className:"col-12"},r.a.createElement("h3",null,"Environments"),this.state.createEnv?r.a.createElement(p,{onCancel:function(){return e.toggleEnvForm()},onCreate:function(t){return e.onCreate(t)}}):r.a.createElement(h,{onChange:function(t){return e.onChangeEnv(t)},onDelete:function(){return e.onDelete()},onToggle:function(){return e.toggleEnvForm()},ref:function(t){return e.envPicker=t},env:this.state.env}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12"},r.a.createElement("h3",null,"New Record"),r.a.createElement(E,{env:this.state.env,onUpdate:function(t){return e.onUpdate(t)}}),r.a.createElement(b,{env:this.state.env,ref:function(t){return e.table=t}}))))}},{key:"renderLoading",value:function(){return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"text-center m-5"},r.a.createElement("div",{className:"spinner-border text-primary",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")))))}},{key:"render",value:function(){return console.debug("c=Home, m=render, state=%o",this.state),r.a.createElement(r.a.Fragment,null,r.a.createElement(f,null),r.a.createElement("div",{className:"container mb-5"},this.state.isLoading?this.renderLoading():this.renderTable()))}}]),t}(r.a.PureComponent);o.a.render(r.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,1,2]]]);
//# sourceMappingURL=main.53cb88dc.chunk.js.map